-- Скрипт для наполнения базы данных реалистичными данными
-- для качественной аналитики и кластеризации

-- 1. Сначала очистим существующие данные заказов
DELETE FROM order_products;
DELETE FROM orders WHERE id > 0;
ALTER TABLE orders AUTO_INCREMENT = 1;

-- 2. Обновим состав продуктов для лучшей аналитики
UPDATE products SET 
    composition = '{"яловичина": 60, "свинина": 35, "спеції": 5}',
    code = 'PROD_0001',
    full_description = 'Преміум ковбаса з яловичини та свинини з ароматними спеціями'
WHERE id = 1;

UPDATE products SET 
    composition = '{"яловичина": 80, "свинина": 15, "спеції": 5}',
    code = 'PROD_0002',
    full_description = 'Елітна яловича ковбаса німецького типу з мінімальним вмістом жиру'
WHERE id = 2;

UPDATE products SET 
    composition = '{"курятина": 85, "свинина": 10, "спеції": 5}',
    code = 'PROD_0003',
    full_description = 'Дієтична куряча ковбаса з філе птиці та натуральними спеціями'
WHERE id = 3;

UPDATE products SET 
    composition = '{"курятина": 75, "свинина": 20, "спеції": 5}',
    code = 'PROD_0004',
    full_description = 'Ніжні курячі сосиски для дитячого та дієтичного харчування'
WHERE id = 4;

UPDATE products SET 
    composition = '{"свинина": 90, "сало": 5, "спеції": 5}',
    code = 'PROD_0005',
    full_description = 'Традиційні свинячі сосиски з натуральною оболонкою'
WHERE id = 5;

UPDATE products SET 
    composition = '{"свинина": 85, "яловичина": 10, "спеції": 5}',
    code = 'PROD_0006',
    full_description = 'Соковиті сарделі з м\'якою текстурою та багатим смаком'
WHERE id = 6;

-- 3. Додамо більше користувачів для різноманітності
INSERT INTO users (name, role, email, password, created_at, updated_at) VALUES
('Петренко В.А.', 'user', 'petrenko@gmail.com', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', NOW(), NOW()),
('Коваленко О.М.', 'user', 'kovalenko@gmail.com', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', NOW(), NOW()),
('Шевченко Т.Г.', 'user', 'shevchenko@gmail.com', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', NOW(), NOW()),
('Мельник І.П.', 'user', 'melnyk@gmail.com', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', NOW(), NOW()),
('Бондаренко С.В.', 'user', 'bondarenko@gmail.com', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', NOW(), NOW()),
('Кравченко Н.О.', 'user', 'kravchenko@gmail.com', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', NOW(), NOW()),
('Морозов А.С.', 'user', 'morozov@gmail.com', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', NOW(), NOW());

-- 4. Додамо відповідних клієнтів
INSERT INTO clients (name, client_name, email, tel, address, user_id, created_at, updated_at) VALUES
('Петренко В.А.', 'ФОП Петренко', 'petrenko@gmail.com', '+380631234567', 'м.Київ, вул. Хрещатик 25', 6, NOW(), NOW()),
('Коваленко О.М.', 'ТОВ Коваленко', 'kovalenko@gmail.com', '+380671234567', 'м.Харків, вул. Сумська 100', 7, NOW(), NOW()),
('Шевченко Т.Г.', 'ФОП Шевченко', 'shevchenko@gmail.com', '+380501234567', 'м.Львів, вул. Свободи 50', 8, NOW(), NOW()),
('Мельник І.П.', 'ПП Мельник', 'melnyk@gmail.com', '+380931234567', 'м.Дніпро, вул. Європейська 30', 9, NOW(), NOW()),
('Бондаренко С.В.', 'ФОП Бондаренко', 'bondarenko@gmail.com', '+380971234567', 'м.Запоріжжя, вул. Соборний 15', 10, NOW(), NOW()),
('Кравченко Н.О.', 'ТОВ Кравченко', 'kravchenko@gmail.com', '+380661234567', 'Одеська обл., м.Южне, вул. Морська 8', 11, NOW(), NOW()),
('Морозов А.С.', 'ФОП Морозов', 'morozov@gmail.com', '+380731234567', 'м.Одеса, вул. Дерибасівська 20', 12, NOW(), NOW());

-- 5. Створюємо реалістичні замовлення за останні 3 місяці
-- Замовлення за березень 2025 (давніші дані)
INSERT INTO orders (client_id, status, comment, created_at, updated_at) VALUES
-- Великі замовлення (високий обсяг + висока виручка)
(4, 'apply', 'Партія для ресторану', '2025-03-05 10:30:00', '2025-03-05 15:20:00'),
(7, 'apply', 'Замовлення для кафе', '2025-03-07 14:15:00', '2025-03-07 16:45:00'),
(10, 'apply', 'Великий корпоративний заказ', '2025-03-12 09:20:00', '2025-03-12 18:30:00'),

-- Середні замовлення 
(5, 'apply', 'Для сімейного святкування', '2025-03-15 11:00:00', '2025-03-15 12:30:00'),
(8, 'apply', 'Регулярне поповнення', '2025-03-18 16:45:00', '2025-03-18 17:00:00'),
(11, 'apply', 'Пробне замовлення', '2025-03-22 13:30:00', '2025-03-22 14:15:00'),

-- Малі замовлення (низький обсяг)
(6, 'apply', 'Невелика закупка', '2025-03-25 12:00:00', '2025-03-25 12:45:00'),
(9, 'reject', 'Відхилено через брак товару', '2025-03-28 10:15:00', '2025-03-29 09:30:00');

-- Квітень 2025
INSERT INTO orders (client_id, status, comment, created_at, updated_at) VALUES
(4, 'apply', 'Повторне замовлення', '2025-04-02 08:30:00', '2025-04-02 17:20:00'),
(7, 'apply', 'Збільшене замовлення', '2025-04-05 15:45:00', '2025-04-05 16:30:00'),
(5, 'apply', 'Святкове меню', '2025-04-08 11:15:00', '2025-04-08 14:00:00'),
(12, 'apply', 'Нове партнерство', '2025-04-12 09:45:00', '2025-04-12 19:15:00'),
(8, 'apply', 'Регулярна доставка', '2025-04-15 14:30:00', '2025-04-15 15:45:00'),
(6, 'active', 'В обробці', '2025-04-18 16:00:00', '2025-04-18 16:00:00'),
(11, 'apply', 'Збільшений асортимент', '2025-04-22 10:30:00', '2025-04-22 18:45:00'),
(9, 'apply', 'Відновлене замовлення', '2025-04-25 13:15:00', '2025-04-25 14:30:00'),
(10, 'reject', 'Проблеми з оплатою', '2025-04-28 11:00:00', '2025-04-29 10:00:00');

-- Травень 2025 (свіжі дані)
INSERT INTO orders (client_id, status, comment, created_at, updated_at) VALUES
(5, 'apply', 'Травневі свята', '2025-05-01 12:00:00', '2025-05-01 18:30:00'),
(4, 'apply', 'VIP замовлення', '2025-05-03 09:15:00', '2025-05-03 20:45:00'),
(12, 'apply', 'Розширене меню', '2025-05-06 14:45:00', '2025-05-06 16:00:00'),
(7, 'apply', 'Літнє меню', '2025-05-10 11:30:00', '2025-05-10 17:15:00'),
(8, 'active', 'Великий заказ в обробці', '2025-05-13 08:45:00', '2025-05-13 08:45:00'),
(11, 'apply', 'Постійний клієнт', '2025-05-16 15:20:00', '2025-05-16 19:30:00'),
(6, 'apply', 'Збільшена кількість', '2025-05-19 10:00:00', '2025-05-19 16:45:00'),
(9, 'active', 'Новий асортимент', '2025-05-22 13:45:00', '2025-05-22 13:45:00'),
(10, 'apply', 'Корпоративна закупка', '2025-05-25 16:30:00', '2025-05-25 20:00:00'),
(12, 'active', 'Термінове замовлення', '2025-05-28 09:00:00', '2025-05-28 09:00:00');

-- 6. Додаємо товари до замовлень для створення різних кластерів
-- Замовлення #1 - Великий обсяг дорогої продукції
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(1, 2, 15, '2025-03-05 10:30:00', '2025-03-05 10:30:00'), -- Брауншвейгска 15 шт х 45 грн = 675 грн
(1, 6, 10, '2025-03-05 10:30:00', '2025-03-05 10:30:00'); -- Сарделькі 10 шт х 33 грн = 330 грн
-- Загальна вартість: 1005 грн

-- Замовлення #2 - Середній обсяг змішаної продукції
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(2, 3, 8, '2025-03-07 14:15:00', '2025-03-07 14:15:00'), -- Гранд-Філе 8 шт х 35 грн = 280 грн
(2, 4, 12, '2025-03-07 14:15:00', '2025-03-07 14:15:00'), -- Сосиски 12 шт х 32 грн = 384 грн
(2, 1, 5, '2025-03-07 14:15:00', '2025-03-07 14:15:00'); -- Імператорська 5 шт х 25 грн = 125 грн
-- Загальна вартість: 789 грн

-- Замовлення #3 - Великий обсяг дешевої продукції
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(3, 5, 25, '2025-03-12 09:20:00', '2025-03-12 09:20:00'), -- Сосиски Улюблені 25 шт х 30 грн = 750 грн
(3, 4, 20, '2025-03-12 09:20:00', '2025-03-12 09:20:00'), -- Сосиски 20 шт х 32 грн = 640 грн
(3, 1, 18, '2025-03-12 09:20:00', '2025-03-12 09:20:00'); -- Імператорська 18 шт х 25 грн = 450 грн
-- Загальна вартість: 1840 грн

-- Замовлення #4 - Малий обсяг дорогої продукції  
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(4, 2, 3, '2025-03-15 11:00:00', '2025-03-15 11:00:00'), -- Брауншвейгска 3 шт х 45 грн = 135 грн
(4, 3, 2, '2025-03-15 11:00:00', '2025-03-15 11:00:00'); -- Гранд-Філе 2 шт х 35 грн = 70 грн
-- Загальна вартість: 205 грн

-- Замовлення #5 - Малий обсяг дешевої продукції
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(5, 1, 4, '2025-03-18 16:45:00', '2025-03-18 16:45:00'), -- Імператорська 4 шт х 25 грн = 100 грн
(5, 5, 3, '2025-03-18 16:45:00', '2025-03-18 16:45:00'); -- Сосиски Улюблені 3 шт х 30 грн = 90 грн
-- Загальна вартість: 190 грн

-- Продовжуємо для решти замовлень...
-- Замовлення #6
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(6, 4, 6, '2025-03-22 13:30:00', '2025-03-22 13:30:00'), -- 192 грн
(6, 6, 4, '2025-03-22 13:30:00', '2025-03-22 13:30:00'); -- 132 грн
-- Загальна вартість: 324 грн

-- Замовлення #7
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(7, 1, 2, '2025-03-25 12:00:00', '2025-03-25 12:00:00'), -- 50 грн
(7, 5, 2, '2025-03-25 12:00:00', '2025-03-25 12:00:00'); -- 60 грн
-- Загальна вартість: 110 грн

-- Замовлення #8 (відхилене)
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(8, 2, 5, '2025-03-28 10:15:00', '2025-03-28 10:15:00'); -- 225 грн

-- Квітневі замовлення
-- Замовлення #9
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(9, 2, 12, '2025-04-02 08:30:00', '2025-04-02 08:30:00'), -- 540 грн
(9, 3, 8, '2025-04-02 08:30:00', '2025-04-02 08:30:00'), -- 280 грн
(9, 6, 6, '2025-04-02 08:30:00', '2025-04-02 08:30:00'); -- 198 грн
-- Загальна вартість: 1018 грн

-- Замовлення #10
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(10, 4, 15, '2025-04-05 15:45:00', '2025-04-05 15:45:00'), -- 480 грн
(10, 5, 20, '2025-04-05 15:45:00', '2025-04-05 15:45:00'), -- 600 грн
(10, 1, 10, '2025-04-05 15:45:00', '2025-04-05 15:45:00'); -- 250 грн
-- Загальна вартість: 1330 грн

-- Замовлення #11
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(11, 3, 7, '2025-04-08 11:15:00', '2025-04-08 11:15:00'), -- 245 грн
(11, 4, 5, '2025-04-08 11:15:00', '2025-04-08 11:15:00'); -- 160 грн
-- Загальна вартість: 405 грн

-- Замовлення #12
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(12, 2, 20, '2025-04-12 09:45:00', '2025-04-12 09:45:00'), -- 900 грн
(12, 6, 15, '2025-04-12 09:45:00', '2025-04-12 09:45:00'), -- 495 грн
(12, 3, 10, '2025-04-12 09:45:00', '2025-04-12 09:45:00'); -- 350 грн
-- Загальна вартість: 1745 грн

-- Замовлення #13
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(13, 1, 8, '2025-04-15 14:30:00', '2025-04-15 14:30:00'), -- 200 грн
(13, 5, 6, '2025-04-15 14:30:00', '2025-04-15 14:30:00'); -- 180 грн
-- Загальна вартість: 380 грн

-- Замовлення #14 (активне)
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(14, 4, 3, '2025-04-18 16:00:00', '2025-04-18 16:00:00'); -- 96 грн

-- Замовлення #15
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(15, 2, 6, '2025-04-22 10:30:00', '2025-04-22 10:30:00'), -- 270 грн
(15, 3, 8, '2025-04-22 10:30:00', '2025-04-22 10:30:00'), -- 280 грн
(15, 1, 5, '2025-04-22 10:30:00', '2025-04-22 10:30:00'); -- 125 грн
-- Загальна вартість: 675 грн

-- Замовлення #16
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(16, 5, 12, '2025-04-25 13:15:00', '2025-04-25 13:15:00'), -- 360 грн
(16, 4, 8, '2025-04-25 13:15:00', '2025-04-25 13:15:00'); -- 256 грн
-- Загальна вартість: 616 грн

-- Замовлення #17 (відхилене)
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(17, 2, 10, '2025-04-28 11:00:00', '2025-04-28 11:00:00'); -- 450 грн

-- Травневі замовлення
-- Замовлення #18
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(18, 1, 15, '2025-05-01 12:00:00', '2025-05-01 12:00:00'), -- 375 грн
(18, 4, 12, '2025-05-01 12:00:00', '2025-05-01 12:00:00'), -- 384 грн
(18, 6, 8, '2025-05-01 12:00:00', '2025-05-01 12:00:00'); -- 264 грн
-- Загальна вартість: 1023 грн

-- Замовлення #19
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(19, 2, 25, '2025-05-03 09:15:00', '2025-05-03 09:15:00'), -- 1125 грн
(19, 3, 18, '2025-05-03 09:15:00', '2025-05-03 09:15:00'), -- 630 грн
(19, 6, 12, '2025-05-03 09:15:00', '2025-05-03 09:15:00'); -- 396 грн
-- Загальна вартість: 2151 грн

-- Замовлення #20
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(20, 4, 20, '2025-05-06 14:45:00', '2025-05-06 14:45:00'), -- 640 грн
(20, 5, 15, '2025-05-06 14:45:00', '2025-05-06 14:45:00'), -- 450 грн
(20, 1, 10, '2025-05-06 14:45:00', '2025-05-06 14:45:00'); -- 250 грн
-- Загальна вартість: 1340 грн

-- Замовлення #21
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(21, 3, 14, '2025-05-10 11:30:00', '2025-05-10 11:30:00'), -- 490 грн
(21, 2, 8, '2025-05-10 11:30:00', '2025-05-10 11:30:00'); -- 360 грн
-- Загальна вартість: 850 грн

-- Замовлення #22 (активне)
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(22, 2, 30, '2025-05-13 08:45:00', '2025-05-13 08:45:00'), -- 1350 грн
(22, 6, 20, '2025-05-13 08:45:00', '2025-05-13 08:45:00'), -- 660 грн
(22, 3, 15, '2025-05-13 08:45:00', '2025-05-13 08:45:00'); -- 525 грн
-- Загальна вартість: 2535 грн

-- Замовлення #23
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(23, 1, 12, '2025-05-16 15:20:00', '2025-05-16 15:20:00'), -- 300 грн
(23, 5, 10, '2025-05-16 15:20:00', '2025-05-16 15:20:00'), -- 300 грн
(23, 4, 8, '2025-05-16 15:20:00', '2025-05-16 15:20:00'); -- 256 грн
-- Загальна вартість: 856 грн

-- Замовлення #24
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(24, 2, 5, '2025-05-19 10:00:00', '2025-05-19 10:00:00'), -- 225 грн
(24, 3, 6, '2025-05-19 10:00:00', '2025-05-19 10:00:00'); -- 210 грн
-- Загальна вартість: 435 грн

-- Замовлення #25 (активне)
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(25, 4, 25, '2025-05-22 13:45:00', '2025-05-22 13:45:00'), -- 800 грн
(25, 5, 18, '2025-05-22 13:45:00', '2025-05-22 13:45:00'); -- 540 грн
-- Загальна вартість: 1340 грн

-- Замовлення #26
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(26, 2, 22, '2025-05-25 16:30:00', '2025-05-25 16:30:00'), -- 990 грн
(26, 6, 16, '2025-05-25 16:30:00', '2025-05-25 16:30:00'), -- 528 грн
(26, 1, 20, '2025-05-25 16:30:00', '2025-05-25 16:30:00'); -- 500 грн
-- Загальна вартість: 2018 грн

-- Замовлення #27 (активне)
INSERT INTO order_products (order_id, product_id, amount, created_at, updated_at) VALUES
(27, 3, 10, '2025-05-28 09:00:00', '2025-05-28 09:00:00'), -- 350 грн
(27, 4, 15, '2025-05-28 09:00:00', '2025-05-28 09:00:00'), -- 480 грн
(27, 5, 12, '2025-05-28 09:00:00', '2025-05-28 09:00:00'); -- 360 грн
-- Загальна вартість: 1190 грн

-- 7. Додаємо дані для матеріалів (сировини)
INSERT INTO materials (title, description, price, created_at, updated_at) VALUES
('Яловичина премум', 'Охолоджене м\'ясо яловичини вищого сорту', 180.00, NOW(), NOW()),
('Свинина без кісток', 'Охолоджена свинина для ковбасного виробництва', 150.00, NOW(), NOW()),
('Філе курячого м\'яса', 'Філе курки охолоджене для дієтичних продуктів', 120.00, NOW(), NOW()),
('Сало свинче', 'Свіже сало для традиційних рецептур', 80.00, NOW(), NOW()),
('Спеції європейські', 'Суміш спецій для м\'ясопереробки', 450.00, NOW(), NOW()),
('Сіль нітритна', 'Спеціальна сіль для консервації м\'яса', 25.00, NOW(), NOW()),
('Оболонка натуральна', 'Свиняча черева для ковбас', 200.00, NOW(), NOW()),
('Емульгатор', 'Харчовий емульгатор для покращення текстури', 300.00, NOW(), NOW());

-- 8. Створюємо замовлення матеріалів
INSERT INTO materials_orders (status, comment, created_at, updated_at) VALUES
('active', 'Тижневе поповнення складу', '2025-05-20 08:00:00', '2025-05-20 08:00:00'),
('active', 'Замовлення спецій', '2025-05-25 14:30:00', '2025-05-25 14:30:00'),
('active', 'Поповнення м\'яса', '2025-05-28 10:15:00', '2025-05-28 10:15:00');

-- Додаємо товари до замовлень матеріалів
INSERT INTO materials_order_products (order_id, material_id, amount, created_at, updated_at) VALUES
(1, 1, 50, '2025-05-20 08:00:00', '2025-05-20 08:00:00'), -- Яловичина 50 кг
(1, 2, 80, '2025-05-20 08:00:00', '2025-05-20 08:00:00'), -- Свинина 80 кг
(1, 3, 30, '2025-05-20 08:00:00', '2025-05-20 08:00:00'), -- Курятина 30 кг
(1, 7, 10, '2025-05-20 08:00:00', '2025-05-20 08:00:00'), -- Оболонка 10 кг

(2, 5, 5, '2025-05-25 14:30:00', '2025-05-25 14:30:00'), -- Спеції 5 кг
(2, 6, 20, '2025-05-25 14:30:00', '2025-05-25 14:30:00'), -- Сіль 20 кг
(2, 8, 3, '2025-05-25 14:30:00', '2025-05-25 14:30:00'), -- Емульгатор 3 кг

(3, 1, 40, '2025-05-28 10:15:00', '2025-05-28 10:15:00'), -- Яловичина 40 кг
(3, 4, 15, '2025-05-28 10:15:00', '2025-05-28 10:15:00'); -- Сало 15 кг

-- 9. Додаткове оновлення кількості товарів після замовлень
UPDATE products SET quantity = quantity - (
    SELECT COALESCE(SUM(op.amount), 0) 
    FROM order_products op 
    JOIN orders o ON o.id = op.order_id 
    WHERE op.product_id = products.id AND o.status = 'apply'
) WHERE id IN (1, 2, 3, 4, 5, 6);

-- 10. Створення індексів для покращення продуктивності аналітики
CREATE INDEX idx_orders_status_created ON orders(status, created_at);
CREATE INDEX idx_order_products_amount ON order_products(amount);
CREATE INDEX idx_products_price ON products(price);
CREATE INDEX idx_users_role ON users(role);

-- 11. Вивід статистики для перевірки
SELECT 'Загальна кількість замовлень' as metric, COUNT(*) as value FROM orders
UNION ALL
SELECT 'Прийняті замовлення', COUNT(*) FROM orders WHERE status = 'apply'
UNION ALL
SELECT 'Активні замовлення', COUNT(*) FROM orders WHERE status = 'active'
UNION ALL
SELECT 'Відхилені замовлення', COUNT(*) FROM orders WHERE status = 'reject'
UNION ALL
SELECT 'Загальна кількість позицій', COUNT(*) FROM order_products
UNION ALL
SELECT 'Унікальних продуктів у замовленнях', COUNT(DISTINCT product_id) FROM order_products;

-- Статистика по сумах замовлень
SELECT 
    'Мінімальна сума замовлення' as metric,
    MIN(order_sum) as value
FROM (
    SELECT 
        o.id,
        SUM(op.amount * p.price) as order_sum
    FROM orders o
    JOIN order_products op ON o.id = op.order_id
    JOIN products p ON op.product_id = p.id
    WHERE o.status = 'apply'
    GROUP BY o.id
) as order_totals

UNION ALL

SELECT 
    'Максимальна сума замовлення',
    MAX(order_sum)
FROM (
    SELECT 
        o.id,
        SUM(op.amount * p.price) as order_sum
    FROM orders o
    JOIN order_products op ON o.id = op.order_id
    JOIN products p ON op.product_id = p.id
    WHERE o.status = 'apply'
    GROUP BY o.id
) as order_totals

UNION ALL

SELECT 
    'Середня сума замовлення',
    ROUND(AVG(order_sum), 2)
FROM (
    SELECT 
        o.id,
        SUM(op.amount * p.price) as order_sum
    FROM orders o
    JOIN order_products op ON o.id = op.order_id
    JOIN products p ON op.product_id = p.id
    WHERE o.status = 'apply'
    GROUP BY o.id
) as order_totals;